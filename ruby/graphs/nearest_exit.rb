# https://leetcode.com/problems/nearest-exit-from-entrance-in-maze/

require 'set'

# @param {Character[][]} maze
# @param {Integer[]} entrance
# @return {Integer}
def nearest_exit(maze, entrance)
  # queue = get_grid(maze, entrance)
  # exits = get_exits(maze, entrance)
  # exits.each do |exit|
  # end
  dijkstra(maze, entrance)
end

def dijkstra(maze, entrance)
  height = maze.size
  width = maze[0].size
  dirs = { u: [-1, 0], r: [0, 1], d: [1, 0], l: [0, -1]}
  queue = Set.new
  dist = {}
  maze.each_with_index do |row, j|
    grid_line = []
    row.each_with_index do |col, i|
      if col == '.'
        pos = [j,i]
        dist[pos] = Float::INFINITY
        queue.add(pos)
      end
    end
  end
  dist[entrance] = 0

  while queue.any?
    pos, _ = min_dist(queue, dist)
    queue.delete(pos)
    p pos
    dirs.each do |d, dir|
      j, i = dir
      new_pos = [pos[0]+j, pos[1]+i]
      p new_pos
      if !!dist[new_pos]
        alt = dist[pos] + 1
        if alt < dist[new_pos]
          dist[new_pos] = alt
          return alt if alt == 1 && exit?(pos, entrance, width, height)
        end
      end
    end
  end

  shortest_path = Float::INFINITY
  dist.each do |pos, path|
    shortest_path = [path, shortest_path].min if exit?(pos, entrance, width, height)
  end
  shortest_path == Float::INFINITY ? -1 : shortest_path
end

# its on border and is not the entrance
def exit?(pos, entrance, width, height)
  (pos[0] == 0 || pos[1] == 0 || pos[0] == (height - 1) || pos[1] == (width - 1)) && pos != entrance
end

def min_dist(queue, dist)
  min = [-1,Float::INFINITY]
  queue.each do |pos|
    value = dist[pos]
    if value <= min[1]
      min = [pos, value]
    end
  end
  min
end

maze = [["+","+",".","+"],[".",".",".","+"],["+","+","+","."]]
entrance = [1,2]
p nearest_exit(maze, entrance)

# maze = [["+","+","+"],[".",".","."],["+","+","+"]]
# entrance = [1,0]
# p nearest_exit(maze, entrance)

# maze = [[".","+"]]
# entrance = [0,0]
# p nearest_exit(maze, entrance)

# maze = [[".","+",".","+","+",".",".","+",".",".",".",".",".","+","+","+",".","+",".",".",".",".",".",".",".",".",".","+","+",".",".","+",".",".",".",".",".",".",".",".",".","+"],["+",".",".",".","+",".",".",".","+",".","+",".","+",".",".","+",".","+",".",".","+",".",".","+",".",".","+",".",".","+",".","+",".",".",".",".",".",".","+","+","+","."],[".",".",".","+",".","+",".",".","+",".",".","+",".",".",".","+",".",".",".",".",".",".",".",".",".",".",".","+",".","+",".",".",".",".",".",".",".",".","+",".",".","+"],[".",".",".","+","+","+",".",".",".","+",".","+",".",".",".",".","+","+",".","+",".","+",".",".",".",".",".",".","+","+",".",".",".","+",".",".",".","+","+",".","+","."],[".",".",".",".","+",".",".",".",".","+",".",".",".",".",".",".",".","+","+",".",".",".","+",".",".","+",".",".","+",".",".",".",".",".",".","+",".","+",".",".",".","+"],[".",".",".",".",".",".",".",".",".",".",".","+",".",".",".",".",".",".","+",".",".",".","+",".","+","+",".",".",".",".",".",".","+",".","+",".",".",".",".",".",".","."],[".",".","+",".","+",".","+",".","+","+",".",".",".",".","+",".",".","+","+","+",".",".",".","+","+","+","+",".","+",".",".",".",".",".",".",".",".",".",".",".",".","."],[".",".","+",".",".","+",".",".","+",".",".","+","+","+","+",".",".","+",".",".","+","+",".",".",".",".",".",".",".","+",".",".","+",".",".","+",".",".",".",".",".","."],["+",".",".",".",".",".","+",".","+",".","+",".","+",".","+",".","+","+",".",".",".",".","+",".",".","+","+",".",".","+",".",".",".","+",".","+","+",".",".",".","+","."],[".",".",".",".",".",".",".",".",".","+",".",".",".",".","+",".",".",".","+",".","+",".",".",".",".","+","+",".",".","+",".",".",".","+","+",".",".",".",".",".",".","."],[".",".","+",".",".",".","+",".",".","+",".",".","+",".","+",".",".",".",".",".",".","+",".",".",".","+",".","+","+","+",".",".",".","+",".",".",".",".",".",".","+","+"],[".","+",".",".",".","+",".",".",".",".","+",".",".",".","+","+",".",".",".",".",".",".","+",".",".",".","+",".",".","+","+","+","+",".","+","+",".",".",".",".",".","+"],["+","+","+","+",".",".","+",".",".","+",".",".",".","+",".","+","+",".","+","+","+",".",".",".",".",".","+",".",".","+",".",".",".",".",".",".",".",".","+","+",".","."],[".",".",".",".",".","+",".",".",".",".",".",".",".",".","+",".",".",".",".",".",".",".",".","+","+","+",".",".","+",".",".",".","+",".",".",".","+","+",".","+","+","."],[".",".",".",".",".","+",".",".",".",".",".",".","+","+",".","+",".","+","+","+",".",".","+",".","+",".",".",".",".",".",".","+",".",".","+",".",".",".",".",".",".","+"],[".",".",".",".",".","+",".",".","+",".",".",".",".","+",".",".",".",".",".",".",".",".",".","+",".",".","+",".",".","+","+",".",".","+","+",".",".",".",".","+",".","."],[".",".",".",".","+",".","+",".",".",".","+",".",".",".","+",".",".",".","+",".",".",".",".",".",".",".",".",".","+",".",".","+",".",".",".",".",".",".",".",".",".","."],["+","+",".",".",".",".",".",".",".",".",".",".",".",".",".","+",".",".",".",".",".",".","+","+",".",".",".",".",".","+",".","+",".",".",".","+","+",".",".","+","+","+"],[".",".","+",".","+","+","+",".",".",".",".",".","+","+","+","+","+",".","+",".",".","+",".",".","+",".",".",".",".",".",".",".","+",".","+",".",".","+","+",".","+","."],[".","+","+",".","+",".",".","+",".",".","+",".","+",".",".","+",".",".","+","+","+",".","+",".",".",".","+",".",".",".",".",".",".","+",".","+","+","+",".","+",".","."],["+",".",".","+",".",".",".",".",".","+",".","+",".","+",".",".",".",".",".",".",".",".","+",".","+","+",".",".","+",".",".","+",".",".",".",".","+","+",".",".",".","+"],["+",".",".",".",".",".",".",".","+","+",".",".",".",".","+","+","+","+","+","+","+","+","+",".",".",".",".",".","+",".",".",".",".",".",".",".","+","+",".",".",".","."],[".","+",".",".",".",".",".","+",".",".","+","+",".",".",".",".",".",".",".","+","+",".",".",".",".",".",".",".","+",".",".",".",".",".",".",".",".",".",".",".","+","."],[".",".",".","+","+",".",".","+",".",".",".",".","+",".",".","+",".","+","+","+","+",".","+","+",".",".",".","+","+",".","+",".",".",".",".",".","+","+",".","+","+","."],[".",".",".","+",".",".","+",".",".","+",".",".",".",".",".",".",".","+",".",".",".","+","+",".",".","+",".",".","+",".","+","+",".",".",".",".","+","+","+","+","+","."],["+",".",".",".",".",".",".",".",".",".",".",".",".","+",".",".",".",".","+",".",".",".","+","+",".","+",".","+",".",".",".","+","+",".","+","+","+",".",".",".","+","+"],["+",".",".",".","+","+",".",".",".","+",".","+",".",".",".","+","+",".",".","+",".",".",".",".",".",".","+",".",".",".","+","+","+",".",".",".",".","+",".",".",".","."],[".","+",".",".",".",".",".","+","+",".",".","+",".","+",".",".",".",".",".",".",".",".","+","+",".",".","+",".",".",".",".",".",".","+","+","+",".","+",".",".","+","+"],[".",".",".",".",".","+",".",".",".",".","+","+","+",".","+",".",".","+",".",".",".","+","+",".","+","+",".",".",".",".",".",".",".",".",".",".","+",".",".",".",".","+"],[".","+",".",".","+",".",".","+",".",".",".",".",".",".","+",".","+","+",".","+",".",".",".","+","+",".","+",".",".",".",".",".",".","+",".","+","+",".",".",".",".","."],[".",".",".",".",".","+",".",".","+",".",".","+","+",".","+",".",".","+",".",".",".",".",".","+",".",".","+",".",".","+","+",".",".",".",".",".",".",".",".",".",".","."],["+","+",".",".","+",".","+",".",".",".",".","+",".",".","+",".",".",".",".",".",".",".","+",".","+",".","+","+","+","+",".","+",".","+","+",".","+",".","+",".","+","."],["+",".",".","+",".","+",".",".",".",".",".",".",".","+","+",".",".","+","+",".",".",".",".","+",".",".","+",".",".",".",".","+",".",".","+",".","+",".",".","+",".","+"],["+",".",".",".",".",".","+","+",".","+",".",".",".",".",".","+",".",".",".",".",".","+","+",".",".",".",".",".",".","+",".","+","+",".",".",".","+","+",".",".",".","."],[".",".","+",".",".","+","+",".","+","+",".",".",".",".",".",".",".",".",".",".",".",".",".",".",".","+",".","+","+","+",".",".",".","+",".",".","+",".",".",".",".","+"],[".",".","+",".",".",".",".",".","+",".","+","+","+",".",".","+",".",".",".",".",".",".",".",".","+",".",".","+",".","+",".","+",".",".",".","+",".",".",".",".","+","."],[".",".",".","+",".","+",".","+",".","+",".",".","+","+","+","+",".",".",".","+",".","+","+","+","+","+",".",".",".","+",".",".",".",".","+","+",".",".",".",".","+","."],[".",".",".","+",".","+",".",".",".","+",".",".","+","+",".",".","+",".",".","+",".",".",".",".","+",".","+",".","+",".",".",".",".",".","+","+",".",".","+",".","+","+"],["+",".","+",".",".",".","+",".","+",".","+",".",".",".",".","+",".","+",".",".",".","+",".",".",".",".","+",".","+",".",".",".",".",".",".",".",".",".",".",".",".","+"],["+",".",".",".","+",".",".",".",".",".","+","+","+",".",".",".","+",".","+","+",".","+",".",".","+",".","+","+",".",".",".",".",".",".",".","+",".","+",".",".",".","."],["+",".",".",".",".",".",".",".","+",".",".",".","+","+",".","+",".",".",".",".",".","+",".",".","+",".",".",".",".",".",".","+",".",".",".",".",".",".",".",".",".","."],[".",".","+","+",".",".",".",".",".",".",".","+","+",".",".","+",".","+",".","+",".",".",".","+",".","+",".",".","+",".",".",".",".","+",".",".",".","+",".",".","+","."],[".",".",".","+","+",".",".",".",".","+",".","+",".",".",".",".",".",".",".",".",".",".","+",".",".",".",".",".",".",".","+",".",".",".","+",".",".",".",".","+",".","."],[".",".",".","+",".",".",".",".",".",".",".",".","+","+",".","+",".",".",".",".","+",".","+",".",".",".",".",".","+","+","+","+",".","+","+",".",".",".",".",".",".","."],["+",".",".",".",".",".",".","+",".",".",".",".","+",".","+",".",".",".",".","+",".","+",".",".",".","+","+",".",".","+",".",".",".","+",".",".",".","+",".",".","+","+"],[".",".","+",".","+","+","+",".",".",".",".",".",".",".",".",".","+","+",".",".",".",".",".","+","+",".","+",".","+",".",".",".",".",".",".",".",".",".",".","+",".","."],[".","+","+",".","+",".",".",".",".",".",".",".",".","+",".","+","+",".",".",".",".",".","+",".","+",".",".","+","+",".",".",".","+","+","+",".",".",".",".",".",".","+"],[".","+",".","+","+",".","+",".",".","+","+","+",".","+",".","+",".",".",".","+","+","+",".",".","+",".",".","+",".","+",".",".","+",".","+",".","+","+",".",".","+","."],[".",".",".","+",".","+","+",".",".",".",".",".",".",".",".","+",".",".","+","+","+",".",".","+",".",".",".",".",".",".","+",".","+",".","+",".",".",".",".",".",".","."]]
# entrance = [48,41]
# p nearest_exit(maze, entrance)
